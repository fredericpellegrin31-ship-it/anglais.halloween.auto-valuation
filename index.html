<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anglais CE1 - Halloween Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            touch-action: manipulation;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            background-color: #1a1a1a;
        }
        .img-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .correct {
            border-color: #22c55e !important;
            background-color: rgba(34, 197, 94, 0.2) !important;
            transform: scale(1.05);
        }
        .wrong {
            border-color: #ef4444 !important;
            background-color: rgba(239, 68, 68, 0.2) !important;
            opacity: 0.5;
        }
        .hidden { display: none; }

        .glass-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #bg-decor {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .floating-item {
            position: absolute;
            opacity: 0.2;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }

        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .pulse-audio {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 15px rgba(249, 115, 22, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); }
        }
    </style>
</head>
<body class="min-h-screen font-sans text-white">

    <div id="bg-decor"></div>

    <!-- √âCRAN D'ACCUEIL -->
    <div id="home-screen" class="flex flex-col items-center justify-center min-h-screen p-6 text-center">
        <div class="glass-card p-10 rounded-3xl shadow-2xl max-w-md w-full border-2 border-orange-500">
            <h1 class="text-5xl font-black mb-4 text-orange-500 uppercase tracking-widest">Halloween</h1>
            <p class="text-xl mb-8 opacity-90 font-medium">Auto-√©valuation Anglais CE1</p>
            <button onclick="startGame()" class="w-full bg-orange-600 hover:bg-orange-500 text-white font-bold py-5 px-8 rounded-2xl text-2xl shadow-lg transform active:scale-95 transition-all">
                C'EST PARTI ! üéÉ
            </button>
        </div>
    </div>

    <!-- JEU -->
    <div id="game-screen" class="hidden min-h-screen p-4 flex flex-col items-center max-w-4xl mx-auto">
        
        <!-- Header -->
        <div class="w-full flex justify-between items-center mb-6 glass-card px-6 py-4 rounded-2xl">
            <div class="text-xl font-bold">Question <span id="current-count">1</span>/16</div>
            <div class="text-xl font-bold text-orange-400">√âcoute et choisis</div>
        </div>

        <!-- Bouton Audio -->
        <div class="flex flex-col items-center mb-8">
            <button onclick="playAudio()" class="w-28 h-28 bg-orange-500 rounded-full flex items-center justify-center shadow-2xl pulse-audio hover:bg-orange-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-14 w-14 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                </svg>
            </button>
        </div>

        <!-- Grille d'images -->
        <div id="options-grid" class="grid grid-cols-2 gap-4 w-full max-w-2xl">
            <!-- JS -->
        </div>

        <!-- Bouton Suivant -->
        <button id="next-btn" onclick="nextQuestion()" class="hidden mt-8 bg-white text-black font-bold py-4 px-12 rounded-2xl text-xl shadow-xl hover:bg-orange-100 transition-all">
            SUIVANT ‚ûî
        </button>
    </div>

    <!-- √âCRAN FINAL -->
    <div id="result-screen" class="hidden flex flex-col items-center justify-start min-h-screen p-4 text-center">
        <div class="glass-card p-6 rounded-3xl shadow-2xl w-full max-w-4xl border-2 border-white mb-4">
            <h2 class="text-3xl font-black mb-2 uppercase">Bilan de tes connaissances</h2>
            <div id="score-display" class="text-4xl font-black mb-4 text-orange-400">0/16</div>
            
            <!-- Grille r√©capitulative 3 colonnes -->
            <div id="summary-grid" class="grid grid-cols-3 gap-4 overflow-y-auto max-h-[60vh] p-2">
                <!-- JS -->
            </div>

            <button onclick="location.reload()" class="mt-8 bg-white text-black font-bold py-4 px-8 rounded-2xl text-xl shadow-lg transform active:scale-95 transition-all">
                REJOUER üîÑ
            </button>
        </div>
    </div>

    <script>
        const vocabulary = [
            { id: 'ghost', word: 'A ghost', img: 'ghost.png' },
            { id: 'monster', word: 'A monster', img: 'monster.png' },
            { id: 'mummy', word: 'A mummy', img: 'mummy.png' },
            { id: 'pirate', word: 'A pirate', img: 'pirate.png' },
            { id: 'pumpkin', word: 'A pumpkin', img: 'pumpkin.png' },
            { id: 'skeleton', word: 'A skeleton', img: 'squeleton.png' },
            { id: 'vampire', word: 'A vampire', img: 'vampire.png' },
            { id: 'witch', word: 'A witch', img: 'witch.png' }
        ];

        let currentIndex = 0;
        let score = 0;
        let shuffledVocab = [];
        let results = []; 
        let canClick = true;
        const synth = window.speechSynthesis;

        function createBackground() {
            const decorEl = document.getElementById('bg-decor');
            decorEl.innerHTML = '';
            const dotColors = ['#f97316', '#7c3aed', '#000000', '#4b5563'];
            const halloweenIcons = ['üéÉ', 'üëª', 'ü¶á', 'üï∑Ô∏è', 'üï∏Ô∏è', 'üßü', 'üç¨', 'üïØÔ∏è'];
            for (let i = 0; i < 30; i++) {
                const div = document.createElement('div');
                div.className = 'floating-item';
                if (Math.random() > 0.4) {
                    const dot = document.createElement('div');
                    dot.className = 'color-dot';
                    dot.style.backgroundColor = dotColors[Math.floor(Math.random() * dotColors.length)];
                    div.appendChild(dot);
                } else {
                    div.className += ' text-5xl';
                    div.textContent = halloweenIcons[Math.floor(Math.random() * halloweenIcons.length)];
                }
                div.style.left = Math.random() * 100 + 'vw';
                div.style.top = Math.random() * 100 + 'vh';
                div.style.animationDuration = (10 + Math.random() * 10) + 's';
                div.style.animationDelay = (Math.random() * 5) + 's';
                decorEl.appendChild(div);
            }
        }

        function playAudio() {
            const utterance = new SpeechSynthesisUtterance(shuffledVocab[currentIndex].word);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            synth.speak(utterance);
        }

        function startGame() {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            // Chaque image passe 2 fois
            shuffledVocab = [...vocabulary, ...vocabulary].sort(() => Math.random() - 0.5);
            currentIndex = 0;
            score = 0;
            results = [];
            showQuestion();
        }

        function showQuestion() {
            canClick = true;
            const current = shuffledVocab[currentIndex];
            document.getElementById('current-count').textContent = currentIndex + 1;
            document.getElementById('next-btn').classList.add('hidden');

            // 4 options : la bonne + 3 mauvaises
            let options = [current];
            const uniqueOthers = vocabulary.filter(v => v.id !== current.id);
            const shuffledOthers = uniqueOthers.sort(() => Math.random() - 0.5);
            options.push(shuffledOthers[0], shuffledOthers[1], shuffledOthers[2]);
            options.sort(() => Math.random() - 0.5);

            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            options.forEach(opt => {
                const card = document.createElement('div');
                card.className = "img-card glass-card p-3 rounded-2xl border-4 border-transparent aspect-square flex items-center justify-center bg-white/5";
                const img = document.createElement('img');
                img.src = opt.img;
                img.className = "max-w-full max-h-full object-contain pointer-events-none";
                card.onclick = () => checkAnswer(card, opt.id);
                card.appendChild(img);
                grid.appendChild(card);
            });

            setTimeout(playAudio, 400);
        }

        function checkAnswer(el, chosenId) {
            if (!canClick) return;
            canClick = false;

            const correctObj = shuffledVocab[currentIndex];
            const isCorrect = (chosenId === correctObj.id);

            if (isCorrect) {
                score++;
                el.classList.add('correct');
            } else {
                el.classList.add('wrong');
                document.querySelectorAll('.img-card').forEach(card => {
                    const img = card.querySelector('img');
                    if (img.src.includes(correctObj.img)) card.classList.add('correct');
                });
            }

            results.push({ ...correctObj, isCorrect });
            document.getElementById('next-btn').classList.remove('hidden');
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < shuffledVocab.length) {
                showQuestion();
            } else {
                endGame();
            }
        }

        function endGame() {
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('score-display').textContent = `${score}/16`;

            const summaryGrid = document.getElementById('summary-grid');
            summaryGrid.innerHTML = '';

            // Groupement pour le bilan (on prend le premier essai de chaque mot pour le r√©sum√© propre)
            // Ou on affiche simplement les 8 mots uniques et leur statut
            vocabulary.forEach(v => {
                const attempts = results.filter(r => r.id === v.id);
                const allCorrect = attempts.every(a => a.isCorrect);
                
                const card = document.createElement('div');
                card.className = `glass-card p-4 rounded-xl border-2 flex flex-col items-center ${allCorrect ? 'border-green-500 bg-green-500/10' : 'border-red-500 bg-red-500/10'}`;
                
                const img = document.createElement('img');
                img.src = v.img;
                img.className = "w-20 h-20 object-contain mb-2";
                
                const status = document.createElement('div');
                status.className = "text-sm font-bold uppercase";
                status.textContent = allCorrect ? "Acquis ‚úÖ" : "√Ä revoir ‚ùå";
                
                card.appendChild(img);
                card.appendChild(status);
                summaryGrid.appendChild(card);
            });
        }

        window.onload = createBackground;
    </script>
</body>
</html>